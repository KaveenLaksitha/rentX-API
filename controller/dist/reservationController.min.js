"use strict";var controller=require("express").Router(),Reservation=require("../model/reservationModel"),_require=require("uuid"),uuidv4=_require.v4,_require2=require("express"),Router=_require2.Router,isMoment=require("moment");controller.route("/addReservation").post(function(e,t){var r=uuidv4(),n=e.body.customername,o=Number(e.body.contactnumber),s=e.body.nic,a=e.body.customernic,c=e.body.customeraddress,i=e.body.packagename,u=e.body.eventtype,d=isMoment(e.body.from).format("YYYY-MMMM-DD"),m=isMoment(e.body.to).format("YYYY-MMMM-DD"),l=Number(e.body.discount),v=Number(e.body.advancedpayment),f=Number(e.body.totalreservation),p=e.body.status;new Reservation({reservationid:r,customername:n,contactnumber:o,nic:s,customernic:a,customeraddress:c,packagename:i,eventtype:u,from:d,to:m,discount:l,advancedpayment:v,totalreservation:f,status:p}).save().then(function(){t.status(200).send({message:"Reservation insert successfully"})}).catch(function(e){t.status(300).send({status:"Error Reservation insertion",error:e.message})})}),controller.route("/displayReservation").get(function(e,t){Reservation.find().then(function(e){t.json(e)}).catch(function(e){console.log(e)})}),controller.route("/getReservation/:RID").get(function(t,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.RID,e.next=3,regeneratorRuntime.awrap(Reservation.findOne({reservationid:n}).then(function(e){null!=e?r.status(200).send({status:"Reservation fetched",reservation:e}):r.status(500).send({status:"Error with get Reservation",error:err.message})}).catch(function(e){console.log(e.message),r.status(500).send({status:"Error with get Reservation",error:e.message})}));case 3:e.sent;case 4:case"end":return e.stop()}})}),controller.route("/deleteReservation").post(function(t,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body.reservationid,console.log("reservation id",n),e.next=4,regeneratorRuntime.awrap(Reservation.findOneAndDelete({reservationid:n}).then(function(){r.status(200).send({status:"Reservation Record deleted"})}).catch(function(){console.log(err),r.status(500).send({status:"Error with deleting reservation record",error:err.message})}));case 4:case"end":return e.stop()}})}),controller.route("/updateReservation/:RID").put(function(t,r){var n,o,s,a,c,i,u,d,m,l,v,f,p,g,R,y,h,b,D;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.RID,o=t.body,o.reservationid,s=o.customername,a=o.contactnumber,c=o.nic,i=o.customernic,u=o.customeraddress,d=o.packagename,m=o.eventtype,l=o.from,v=o.to,f=o.discount,p=o.advancedpayment,g=o.totalreservation,R=o.status,y=o.penaltyDay,h=o.penaltyCharge,b=o.returnDay,D={RID:n,customername:s,contactnumber:a,nic:c,customernic:i,customeraddress:u,packagename:d,eventtype:m,from:l,to:v,discount:f,advancedpayment:p,totalreservation:g,status:R,penaltyDay:y,penaltyCharge:h,returnDay:b},e.next=5,regeneratorRuntime.awrap(Reservation.findOneAndUpdate({reservationid:n},D).then(function(){r.status(200).send({status:"Reservation Record updated"})}).catch(function(e){console.log(e),r.status(500).send({status:"Server error Error with updating data",error:e.message})}));case 5:e.sent;case 6:case"end":return e.stop()}})}),controller.route("/pendingReservationCount").get(function(e,t){Reservation.find({status:/pending/}).count().then(function(e){t.json(e)}).catch(function(e){console.log(e)})}),controller.route("/searchReservationRecs/:customernic").get(function(e,t){var r=e.params.customernic.trim();Reservation.find({customernic:{$regex:"^"+r+".*",$options:"i"}}).then(function(e){t.json(e)}).catch(function(e){console.log(e)})}),controller.route("/searchReservationRecordsX/:rVal").get(function(e,t){var r=e.params.rVal.trim();Reservation.find({status:{$regex:".*"+r+".*",$options:"i"}}).then(function(e){t.json(e)}).catch(function(e){console.log(e)})}),controller.route("/searchPendingReservationRecords").get(function(e,t){Reservation.find({status:{$regex:".*completed.*",$options:"i"}}).then(function(e){t.json(e)}).catch(function(e){console.log(e)})}),module.exports=controller;
//# sourceMappingURL=reservationController.min.js.map
